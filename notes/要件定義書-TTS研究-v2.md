# 要件定義書：少量データTTS研究プロジェクト

---

## 📋 プロジェクト概要

| 項目               | 内容                                        |
| ------------------ | ------------------------------------------- |
| **プロジェクト名** | 少量特徴量を用いた音声合成モデルの構築         |
| **サブタイトル**   | JVSコーパスを用いた音声特徴量の重要度分析   |
| **学籍番号**       | TK230037                                    |
| **氏名**           | 國政 蒼矢                                   |
| **研究科目**       | 人工知能応用（自由研究）                    |
| **研究期間**       | 2025年11月21日 ～ 2025年1月30日（約10週間） |
| **最終発表日**     | 2025年1月30日（企業来訪あり）               |
| **中間発表日**     | 2025年12月5日                               |

---

## 🎯 研究の最終ゴール

### メインゴール
**「少量データで効率的にTTSモデルを学習するための必要最低限コーパスを設計し、音声特徴量の重要度を定量的に分析する」**

### 研究の核心
本研究は、「どの文・どの特徴量が音声合成の品質に最も寄与するか」を明らかにし、最小限のコーパスでも高品質なTTSモデルを構築できることを実証する。

---

## 🔬 研究アプローチ

### 1. 使用するデータ
- **JVSコーパス（parallel100）**
  - 100文 × 100話者の日本語音声データ
  - プロの声優による高品質な録音
  - 無料・商用可能（研究用途）
  - 参考：https://sites.google.com/site/shinnosuketakamichi/research-topics/jvs_corpus

### 2. 研究の流れ
```
Step 1: JVS parallel100から1〜数話者を選定
   ↓
Step 2: 音声特徴量の分析
   - メルスペクトログラム
   - F0（基本周波数・ピッチ）
   - エネルギー（音量）
   - デュレーション（音素の長さ）
   - 音素カバレッジ
   ↓
Step 3: TTSモデルでの特徴量重要度分析
   - Attention Map可視化
   - 勾配ベース分析（Integrated Gradients）
   - 音素カバレッジ分析
   - コーパス削減実験（段階的削除法）
   ↓
Step 4: 必要最低限コーパスの設計
   - 特徴量密度の高い文を厳選
   - 音素カバレッジ90%以上を目指す
   - F0・エネルギー変動のバリエーション確保
   ↓
Step 5: 品質評価・比較
   - フルコーパス（100文）vs 削減コーパス（20文程度）
   - MOS（主観評価）+ MCD（客観評価）+ F0誤差
   ↓
Step 6: 結果の提示・考察
```

---

## 🎯 達成すべき目標

### 1. コーパス設計（メイン研究テーマ）
- [ ] JVS parallel100の音声特徴量を網羅的に分析
- [ ] TTSモデルが「どの特徴量をどれくらい重視しているか」を定量化
- [ ] 必要最低限コーパス（20文程度）を設計
- [ ] 「この〇文を録音すれば音素の90%以上をカバーできる」というガイドラインを提示

### 2. 特徴量の重要度分析
- [ ] Attention Map を用いた音素レベルの可視化
- [ ] 勾配分析による周波数帯・音素の重要度測定
- [ ] コーパス削減実験による各文の寄与度推定

### 3. 品質評価
- [ ] フルコーパス vs 削減コーパスでの品質比較
- [ ] MOS、MCD、F0誤差での定量評価
- [ ] 「何文あれば実用レベルか」を数値的に提示

### 4. 技術的検証（サブ目標）
- [ ] 既存フレームワーク（StyleTTS2 or ESPNet系）が無料環境で動作することを確認
- [ ] 学習時間・GPU負荷の測定

---

## 🔊 音声特徴量の定義

本研究で扱う主要な音声特徴量は以下の通り：

### 1. 時間領域特徴量
| 特徴量                   | 説明                | TTSでの役割            |
| ------------------------ | ------------------- | ---------------------- |
| **波形（Waveform）**     | 音声信号そのもの    | 最終的な出力形式       |
| **エネルギー（Energy）** | 音の強さ・音量      | アクセント・強弱の再現 |
| **ゼロ交差率**           | 波形が0を横切る頻度 | 音の性質分析           |

### 2. 周波数領域特徴量（最重要）
| 特徴量                   | 説明                       | TTSでの役割              |
| ------------------------ | -------------------------- | ------------------------ |
| **メルスペクトログラム** | 時間×周波数の2次元表現     | **TTSモデルの主要入力**  |
| **F0（基本周波数）**     | 声の高さ                   | イントネーション・話者性 |
| **MFCC**                 | メル周波数ケプストラム係数 | 音響特性の圧縮表現       |

### 3. 言語特徴量
| 特徴量             | 説明                 | TTSでの役割       |
| ------------------ | -------------------- | ----------------- |
| **音素列**         | テキストを音素に変換 | **TTSの入力の核** |
| **デュレーション** | 各音素の長さ         | 発話速度・リズム  |
| **アクセント**     | 高低アクセントの位置 | 日本語の自然さ    |

### 4. スタイル特徴量
| 特徴量               | 説明               | TTSでの役割  |
| -------------------- | ------------------ | ------------ |
| **話者埋め込み**     | 話者の特徴ベクトル | 話者性の再現 |
| **スタイル埋め込み** | 話し方・感情の特徴 | 表現力の向上 |

---

## 📊 特徴量の重要度分析手法

### 方法1: Attention Map 分析
- **内容**: Encoder-Decoder間のAttention機構を可視化
- **わかること**: 
  - どの音素がどの時間領域の音声に対応しているか
  - 音素の重要度（Attentionの強さ）
- **実装**: StyleTTS2やVITSのAttention weightを抽出

### 方法2: 勾配ベース分析（Integrated Gradients）
- **内容**: 出力に対する入力の影響度を勾配で測定
- **わかること**:
  - メルスペクトログラムのどの周波数帯が重要か
  - どの音素が品質に大きく影響するか
- **実装**: PyTorchの勾配計算機能を利用

### 方法3: 音素カバレッジ分析
- **内容**: 各文に含まれる音素を集計
- **わかること**:
  - どの文がどの音素をカバーしているか
  - 必要最小限の文セット
- **実装**: 日本語音素解析（pyopenjtalk等）

### 方法4: コーパス削減実験（Ablation Study）
- **内容**: 特定の文を除いて学習し、品質変化を測定
- **わかること**:
  - どの文が学習に必須か
  - 文の重要度ランキング
- **実装**: 複数パターンで学習・評価

---

## 📈 評価指標

### 主観評価：MOS（Mean Opinion Score）
- **定義**: 1〜5段階の主観的品質評価
- **評価項目**:
  1. 自然さ（Naturalness）
  2. 話者類似度（Speaker Similarity）
  3. 聞き取りやすさ（Intelligibility）
- **実施方法**:
  - 自分 + 友人3〜5名
  - ランダム順で音声を聴き比べ
  - 各項目を1〜5で評価
- **集計**: 平均値を算出

### 客観評価1：MCD（Mel-Cepstral Distortion）
- **定義**: 原音声と合成音声のメルケプストラム距離
- **特徴**:
  - 低いほど原音に近い（良い）
  - 自動計算可能
- **実装**: librosaやpysptk等で計算
- **目標値**: 6.0以下が良好

### 客観評価2：F0 RMSE（ピッチ誤差）
- **定義**: 基本周波数の二乗平均平方根誤差
- **特徴**:
  - イントネーションの再現性を評価
  - 話者性の指標
- **実装**: pyworld等でF0抽出→RMSE計算
- **目標値**: 低いほど良い

### 客観評価3：音素誤差率（PER: Phoneme Error Rate）
- **定義**: 合成音声をASRで音素列に変換し、元と比較
- **特徴**:
  - 発音の正確性を評価
  - 客観的な品質指標
- **実装**: 音声認識モデル（ESPNet等）で音素認識
- **目標値**: 10%以下が良好

### その他の評価
| 指標          | 内容                  | 目的       |
| ------------- | --------------------- | ---------- |
| **学習時間**  | 1エポックあたりの時間 | 効率性評価 |
| **GPU使用率** | 学習時のGPU負荷       | コスト評価 |
| **推論速度**  | 1文の合成にかかる時間 | 実用性評価 |

---

## 🎁 成果物（Deliverables）

### 1. 学術的成果物

#### 1-1. 中間発表資料（Week 3, 12/5）
- **内容**:
  - 研究背景・動機
  - JVSコーパスの分析結果
  - 使用フレームワークの選定理由
  - 後半の実験計画
- **形式**: PowerPoint or PDF
- **ボリューム**: 10-15スライド

#### 1-2. 最終発表資料（Week 8, 1/30）
- **内容**:
  - 研究全体の成果
  - 特徴量重要度分析の結果
  - 必要最低限コーパスの提案
  - デモ音声（複数パターン比較）
  - 企業向けの実用的価値
- **形式**: PowerPoint or PDF
- **ボリューム**: 20-30スライド
- **重要**: 企業の方が来るため、質・完成度を最優先

#### 1-3. 最終報告書（論文形式）
- **章構成**:
  1. 序論（背景・目的・意義）
  2. 関連研究
  3. 提案手法（特徴量分析・コーパス設計）
  4. 実験（データ・フレームワーク・評価方法）
  5. 結果
  6. 考察（重要度分析・コーパス削減の効果）
  7. 結論・今後の課題
- **形式**: Markdown or PDF
- **ボリューム**: 15-25ページ
- **提出期限**: 1/30

---

### 2. 技術的成果物

#### 2-1. 必要最低限コーパスガイドライン
- **内容**:
  - 推奨文セット（20文程度）
  - 各文の音素カバレッジ
  - 特徴量分析結果（F0レンジ、エネルギー変動等）
  - 「この文セットで音素の〇%をカバー」という定量的提示
- **形式**: Markdown + 図表
- **価値**: 実務者（声優、ナレーター等）向けガイド

#### 2-2. 特徴量重要度分析レポート
- **内容**:
  - Attention Map の可視化結果
  - 勾配分析の結果
  - 音素別・周波数帯別の重要度スコア
  - コーパス削減実験の結果
- **形式**: PDF or Markdown
- **価値**: TTSコーパス設計の学術的知見

#### 2-3. 学習済みモデル一式
- **内容**:
  - フルコーパス（100文）モデル
  - 削減コーパス（20文程度）モデル
  - （オプション）最適化版モデル
- **形式**: PyTorch (.pth)
- **保管**: GitHub + ローカル

#### 2-4. 音声サンプル集
- **内容**:
  - フルコーパス vs 削減コーパスの比較音声
  - 共通評価文（5〜10文）での合成結果
  - 原音声（参照用）
- **形式**: WAV
- **保管**: GitHub Releases or Google Drive

#### 2-5. GitHubリポジトリ
- **内容**:
  - 実装コード（Python）
  - 前処理スクリプト
  - 特徴量分析スクリプト
  - 学習スクリプト
  - 評価スクリプト
  - セットアップ手順（README）
- **公開度**: Public

#### 2-6. 実験データ
- **内容**:
  - 音素カバレッジ分析表（CSV）
  - MOS評価結果（CSV）
  - MCD/F0誤差計算結果（CSV）
  - Attention Map画像
  - 学習ログ
- **形式**: CSV, JSON, PNG
- **保管**: GitHub

---

## 📅 詳細スケジュール

### Week 1: 11/21 - 11/27（準備・調査）✅ 完了

#### 達成目標
- [x] 研究テーマの確定
- [x] JVSコーパスの理解
- [x] 実験環境の準備

---

### Week 2: 11/28 - 12/4（環境構築＆JVS分析開始）

#### 達成目標
- [ ] TTSフレームワークの動作確認（1つ選定）
- [ ] JVSコーパスのダウンロード・前処理
- [ ] 音素カバレッジ分析の開始

#### 具体的タスク

| 日付   | タスク                             | 成果物            | 時間 | 場所    |
| ------ | ---------------------------------- | ----------------- | ---- | ------- |
| 11/28  | JVSコーパスのダウンロード          | parallel100データ | 2h   | 学校    |
| 11/28  | 話者選定（1〜3名）                 | 選定理由メモ      | 1h   | 学校    |
| 11/29  | フレームワーク選定・環境構築       | 動作確認完了      | 4h   | 学校    |
| 11/30  | 音素カバレッジ分析スクリプト作成   | 分析スクリプト    | 3h   | 学校    |
| 12/1   | 100文の音素カバレッジ分析実行      | 分析結果CSV       | 2h   | 家      |
| 12/2-3 | ベースライン学習テスト（10文程度） | 試作モデル        | 4h   | 学校+家 |
| 12/4   | 中間発表資料作成（80%）            | パワポ            | 4h   | 学校    |

#### チェックリスト
- ✅ JVS parallel100が手元にある
- ✅ 使用フレームワークが動作する
- ✅ 100文の音素カバレッジが数値化できた
- ✅ 中間発表の準備ができた

---

### Week 3: 12/5（中間発表週）

#### 達成目標
- [ ] 中間発表の実施
- [ ] フィードバックの記録と計画調整

#### 具体的タスク

| 日付 | タスク             | 成果物   |
| ---- | ------------------ | -------- |
| 12/5 | 中間発表           | 発表資料 |
| 12/5 | フィードバック整理 | 調整メモ |

**注意**: この週は発表に集中、研究作業なし

---

### Week 4: 12/12 - 12/18（フルコーパス学習＆特徴量分析）

#### 達成目標
- [ ] フルコーパス（100文）での学習完了
- [ ] Attention Map の抽出・可視化
- [ ] F0・エネルギー分析の実施

#### 具体的タスク

| 日付     | タスク                           | 成果物       | 時間 | 場所  |
| -------- | -------------------------------- | ------------ | ---- | ----- |
| 12/12    | データセット準備（100文フル）    | 学習用データ | 2h   | 学校  |
| 12/13-15 | フルコーパス学習（100文）        | モデル＋ログ | 自動 | 家GPU |
| 12/16    | Attention Map 抽出スクリプト作成 | 可視化コード | 3h   | 学校  |
| 12/17    | Attention Map 可視化実行         | 画像ファイル | 2h   | 学校  |
| 12/18    | F0・エネルギー分析               | 分析結果CSV  | 3h   | 学校  |

#### チェックリスト
- ✅ フルコーパスモデルが完成
- ✅ Attention Mapが可視化できた
- ✅ F0・エネルギーの分布が把握できた

---

### Week 5: 12/19 - 12/25（コーパス削減実験＋重要度分析）

#### 達成目標
- [ ] コーパス削減実験（20文版）の学習完了
- [ ] 勾配分析の実施
- [ ] 文の重要度ランキング作成

#### 具体的タスク

| 日付     | タスク                       | 成果物       | 時間 |
| -------- | ---------------------------- | ------------ | ---- |
| 12/19    | 削減コーパス設計（20文選定） | 文リスト     | 3h   |
| 12/20-22 | 削減コーパス学習（20文）     | モデル       | 自動 |
| 12/23    | 勾配分析スクリプト作成       | 分析コード   | 4h   |
| 12/24    | 勾配分析実行                 | 重要度スコア | 3h   |
| 12/25    | 文の重要度ランキング作成     | ランキング表 | 2h   |

#### チェックリスト
- ✅ 削減コーパスモデルが完成
- ✅ 各文の重要度が数値化された
- ✅ 必要最低限コーパスの候補が絞れた

---

### Week 6: 1/9 - 1/15（品質評価＋ガイドライン作成）

#### 達成目標
- [ ] MOS評価の実施
- [ ] MCD・F0誤差の計算
- [ ] 必要最低限コーパスガイドライン（ドラフト）

#### 具体的タスク

| 日付    | タスク                     | 成果物       | 時間 |
| ------- | -------------------------- | ------------ | ---- |
| 1/9     | 評価用音声の生成（共通文） | 音声ファイル | 2h   |
| 1/10    | MOS評価実施（自分＋友人）  | 評価スコア表 | 3h   |
| 1/11    | MCD・F0誤差計算            | 客観評価結果 | 3h   |
| 1/12-13 | 結果の可視化（グラフ作成） | 図表         | 4h   |
| 1/14    | コーパスガイドライン執筆   | ドラフト版   | 4h   |
| 1/15    | 最終発表資料作成開始       | パワポ60%    | 4h   |

#### チェックリスト
- ✅ フル vs 削減の品質差が定量化された
- ✅ コーパスガイドラインが形になった
- ✅ 発表のストーリーが固まった

---

### Week 7: 1/16 - 1/22（資料完成＋追加実験）

#### 達成目標
- [ ] 最終発表資料完成
- [ ] 最終報告書（論文）80%完成
- [ ] （オプション）追加の最適化実験

#### 具体的タスク

| 日付    | タスク                   | 成果物         | 時間 |
| ------- | ------------------------ | -------------- | ---- |
| 1/16-17 | 最終報告書執筆           | 論文80%        | 8h   |
| 1/18-19 | 最終発表資料完成         | パワポ完成     | 6h   |
| 1/20    | 発表リハーサル           | フィードバック | 2h   |
| 1/21-22 | 追加実験（時間があれば） | 補足データ     | 任意 |

#### チェックリスト
- ✅ 発表資料完成
- ✅ 論文ドラフト完成
- ✅ リハーサル済み

---

### Week 8: 1/23 - 1/30（最終仕上げ＋発表）

#### 達成目標
- [ ] 最終発表の実施（企業向け）
- [ ] 全成果物の提出・公開

#### 具体的タスク

| 日付    | タスク                       | 成果物         | 時間 |
| ------- | ---------------------------- | -------------- | ---- |
| 1/23-24 | 発表準備・デモ確認           | 最終調整       | 3h   |
| 1/25-27 | 論文最終仕上げ               | 最終報告書     | 5h   |
| 1/28-29 | GitHub整備（コード・README） | 公開リポジトリ | 4h   |
| 1/30    | **最終発表**                 | 発表＋名刺交換 | 授業 |

#### チェックリスト
- ✅ すべての成果物が完成
- ✅ GitHubで公開済み
- ✅ 企業の方から評価・名刺獲得

---

## ⚙️ 実装環境

### 開発ツール

| ツール               | 用途                     | コスト |
| -------------------- | ------------------------ | ------ |
| **Google Colab**     | 前処理、分析、小規模実験 | 無料   |
| **ローカルPC（家）** | 本格的な学習             | 無料   |
| **VSCode**           | コード編集               | 無料   |
| **GitHub**           | コード管理・公開         | 無料   |
| **Google Drive**     | データ共有・バックアップ | 無料   |

### 作業場所の使い分け

#### 学校（授業時間 1-3限）
- **活動**: 前処理、分析、コード確認
- **ツール**: Google Colab、VSCode
- **利点**: ネット環境安定、相談可能

#### 家（放課後～夜）
- **活動**: 本格的な学習、GPU処理
- **ツール**: ローカルPC（GPU）
- **利点**: GPU使い放題、時間制限なし

---

## 🔬 使用するフレームワーク（候補）

### 選定基準
- 無料・オープンソース
- 日本語対応
- Attention機構あり（分析のため）
- ドキュメント充実

### 候補1: StyleTTS2（最有力）
- **特徴**: 少量データ対応、スタイル制御
- **利点**: Attention可視化しやすい
- **参考**: https://github.com/yl4579/StyleTTS2

### 候補2: ESPNet（実績多数）
- **特徴**: 音声処理の統合ツールキット
- **利点**: 日本語コーパス実績あり
- **参考**: https://github.com/espnet/espnet

### 候補3: VITS（End-to-End）
- **特徴**: 高品質、実装確立
- **利点**: Attention抽出可能
- **参考**: https://github.com/jaywalnut310/vits

**最終判断**: Week 2で1つに絞る

---

## 🎤 使用データ：JVSコーパス

### 概要
- **提供元**: 東京大学 高道研究室
- **内容**: 日本語多話者音声コーパス
- **話者数**: 100名（プロの声優）
- **収録内容**:
  - parallel100: 100文（話者間で共通）
  - nonpara30: 30文（話者ごとに異なる）
  - その他: ささやき声、裏声など
- **音質**: スタジオ録音、24kHz
- **ライセンス**: 研究用途は無料

### 本研究での使用方法
- **使用部分**: parallel100（100文）
- **選定話者**: 1〜3名
- **理由**: 
  - 全話者が同じ文を読んでいる
  - 音素カバレッジ分析がしやすい
  - 比較実験に最適

### ダウンロード
- 公式サイトから申請・ダウンロード
- https://sites.google.com/site/shinnosuketakamichi/research-topics/jvs_corpus

---

## 📈 実験の全体フロー

```
Week 1: 準備完了 ✅
   ↓
Week 2: 環境構築 + JVS分析
   ↓
Week 3: 中間発表
   ↓
Week 4: フルコーパス学習 + Attention分析
   ↓
Week 5: コーパス削減実験 + 重要度分析
   ↓
Week 6: 品質評価 + ガイドライン作成
   ↓
Week 7: 資料完成 + 追加実験
   ↓
Week 8: 最終発表（企業向け）+ 公開
```

---

## 🎯 研究の差別化ポイント

### 1. 実用的価値
- 「最小限のコーパスでTTSモデルを作る方法」は実務で需要が高い
- 声優・ナレーター業界で活用可能
- 低リソース環境（地方言語、個人プロジェクト等）に貢献

### 2. 学術的貢献
- 音声特徴量の重要度を定量化
- コーパス設計の体系的手法を提示
- Attention分析・勾配分析の応用

### 3. 完全無料環境での実現
- 企業が導入する際のコスト試算
- 「無料でここまでできる」を実証

---

## ⚠️ 想定リスク＆対応策

### リスク1: フレームワークのセットアップが難しい
- **対応**: 
  - Week 2で早めに確認
  - Dockerコンテナ利用
  - 複数候補を準備

### リスク2: Attention分析がうまくいかない
- **対応**:
  - 音素カバレッジ分析に注力
  - コーパス削減実験で代替

### リスク3: 学習時間が想定より長い
- **対応**:
  - パラメータ削減
  - 家のGPUをフル活用
  - Week 4-5のスケジュール調整

### リスク4: 品質評価の協力者が集まらない
- **対応**:
  - 自分の評価＋客観指標重視
  - 最低3名確保を目標

### リスク5: 研究が完結しない
- **対応**:
  - 優先度：コーパス分析 > 品質評価 > 追加実験
  - 最悪、フルコーパス学習のみでも成立させる

---

## 📚 参考文献

### 主要論文
1. **StyleTTS2**: https://arxiv.org/pdf/2306.07691
2. **VITS**: https://arxiv.org/abs/2106.06103
3. **JVS Corpus**: https://arxiv.org/abs/1908.06248
4. **Attention機構**: https://arxiv.org/abs/1706.03762

### 参考記事
- 初心者が一か月でTTSつくってみた: https://qiita.com/niwatiki/items/c2fca0307c8718bf3c61

---

## 🔗 関連リンク

- [JVSコーパス公式](https://sites.google.com/site/shinnosuketakamichi/research-topics/jvs_corpus)
- [StyleTTS2 - GitHub](https://github.com/yl4579/StyleTTS2)
- [ESPNet - GitHub](https://github.com/espnet/espnet)
- [VITS - GitHub](https://github.com/jaywalnut310/vits)
- [Google Colab](https://colab.research.google.com/)
- 本研究用GitHubリポジトリ（後で作成）

---

**作成日**: 2025年11月28日  
**最終更新**: 2025年11月28日  
**状態**: 最新版（v2.0）

---

## 📝 変更履歴

### v2.0（2025-11-28）
- タイトルを「少量データTTSにおける必要最低限コーパスの設計」に変更
- 研究の軸をコーパス設計・特徴量分析に完全シフト
- 音声特徴量の詳細定義を追加
- 特徴量重要度分析手法を明記
- JVSコーパス使用を前提に再構成
- 自分の声録音を必須項目から削除
- フレームワーク比較を副次的な位置付けに変更
- スケジュールを新方針に合わせて再編成

### v1.0（2025-11-28）
- 初版作成